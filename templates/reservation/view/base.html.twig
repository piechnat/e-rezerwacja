{% extends 'base.html.twig' %}

{% block main %}

<style type="text/css">
.table-view {
  overflow: auto;
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
}
.table-view .table-view-header {
  max-width: calc(800px + 4%);
  margin: 0 auto;
  position: sticky;
  left: 0;
  padding: 0.4em calc(2% + 0.4em);
  box-sizing: border-box;
}
.table-view .table-view-body {
  position: relative;
  z-index: 1;
  background-color: #f0f0f0;
  box-shadow: 0.05rem 0.05rem 0.3rem 0.05rem rgba(45,45,45,0.3);
}
.table-view table {
  border-collapse: separate;
  border-spacing: 0;
  margin: 0 auto;
  border: solid #ccc;
  border-width: 1px 0 0 1px;
}
.table-view th, .table-view td {
  position: relative;
  padding: 0.3em;
  border-right: 1px solid #bbb;
  color: #000;
  background-color: #fff;
  min-width: 6em;
}
.table-view td {
  background-image: url("{{ asset('images/table_view_bg.png') }}");
  background-size: 1px 1.875em;
  overflow: hidden;
}
.table-view th {
  position: -webkit-sticky;
  position: sticky;
  z-index: 10;
  background-color: #ddd;
  font-weight: 400;
  color: #333;
  white-space: nowrap;
}
.table-view th.marked {
  font-weight: bold;
}
.table-view thead th {
  top: 0;
  border-bottom: 1px solid #bbb;
}
.table-view tbody th, .table-view thead th:first-child {
  left: 0;
  min-width: 3.5em;
}
.table-view thead th:first-child {
  z-index: 11;
}
.table-view td .rsvn-item {
  box-sizing: border-box;
  position: absolute;
  left: 0.3em;
  right: 0.3em;
  background-color: #9bd28d;
  border-radius: 0.3rem;
  overflow: hidden;
  opacity: 0.9;
  border: solid #777;
  border-width: 0 1px 1px 0;
  transition: box-shadow 0.5s;
}
.table-view td .rsvn-fullname {
  padding: 0.1em 0.4em;
  font-size: 0.9em;
}
.table-view table a {
  color: #000;
}
.table-view table a:active .rsvn-item {
  box-shadow: 0px 0px 0.1em 0.2em #2d2dc577;
  transition: none;
  z-index: 1;
}
.table-view th.hours-header {
  line-height: 3.75em;
  vertical-align: top;
  padding: 1.875em 0;
}
.table-view td .add-item {
  box-sizing: border-box;
  position: absolute;
  left: 4%;
  right: 4%;
  background-color: rgba(0, 0, 0, 0);
  border-radius: 0.3rem;
  overflow: hidden;
  transition: background-color 0.5s;
}
.table-view table a:active .add-item {
  background-color: rgba(0, 0, 0, 0.1);
  transition: none;
  z-index: 1;
}
</style>

<div class="table-view">
  <div class="table-view-header">

  {% if table_view is null %}

      <h2 class="main-title">{{ 'bx bx-calendar-week'|ico }}{{ block('title')|trans }}</h2>
      {{ block('table_view_form') }}

  {% elseif table_view.columns|length == 0 %}

      {{ block('table_view_form') }}
      <p>Nie znaleziono sal spełniających zadane kryteria.</p>

  {% elseif table_view.columns|length > 0 %}

      {{ block('table_view_form') }}
    
  </div> 
  <div class="table-view-body">
    <table>
      <thead>
        <tr>
          <th></th>

          {% block table_view_headers %}{% endblock %}

        </tr>
      </thead>
      <tbody>
        <tr>
          <th class="hours-header">
          {% for i in (table_view.meta.min_hour + 1)..(table_view.meta.max_hour - 1) %}
            {{ '%02d'|format(i) }}:00<br>
          {% endfor %}
          </th>
          {% for key, column in table_view.columns %}
          <td>
            {% for item in column %}
              {% if item.id > 0 %}
              <a href="{{ path('reservation_show', {id: item.id}) }}">
                <div class="rsvn-item" style="{{ item|col_css }}">
                  <div class="rsvn-fullname">{{ item.user_fullname }}</div>
                </div>
              </a>
              {% else %}
              <a href="{{ path('reservation_add', {
                  room_id: table_view.headers[key]['id'],
                  beginTime: item.begin_time|date('Y-m-d H:i'),
                  endTime: item.end_time|date('Y-m-d H:i')
                }) }}">
                <div class="add-item" style="{{ item|col_css }}"></div>
              </a>
              {% endif %}
            {% endfor %}
          </td>
          {% endfor %}
        </tr>
      </tbody>
    </table>
  </div>

  {% endif %}
</div>

{% endblock %}

{% block footer %}{% endblock %}