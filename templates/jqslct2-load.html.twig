<script>

$('select.jqslct2-multiple-select').select2({
    closeOnSelect: false,
    width: 'style',
});

$('select.jqslct2-single-select').select2({
    minimumResultsForSearch: Infinity, 
    width: 'style',
});

$('input.jqslct2-single-user').each(function(i, elm) {

    var select = $('<select>');
    var input = $(elm).replaceWith(select);
    $.each(input.prop('attributes'), function() {
        if ($.inArray(this.name, ['name', 'required', 'id', 'style', 'class']) > -1) {
            select.attr(this.name, this.value);
        }
    });
    var i, email = input.prop('value'), text = input.data('text');             
    if (!email.length) for (i = 0, text = ''; i < 50; i++) text += '&nbsp;';
    
    var render = function(data) {
        return data.text + (data.id ? ' (' + data.id.split('@')[0] + ')' : '');
    };
    select.append(`<option value="${email}">${text}</option>`).select2({
        language: 'pl',
        minimumInputLength: 3,
        width: 'style',
        templateResult: render,
        templateSelection: render,
        ajax: {
            url: '/jsonapi/find/user',
            dataType: 'json',
            delay: 400,
            cache: true,
        },
    });

});

</script>